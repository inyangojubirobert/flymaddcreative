<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vote - One Dream Initiative | FlyMadd Creative</title>
    <meta name="description" content="Support your favorite participant in the One Dream Initiative. Cast your vote and help make dreams come true.">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">

    <!-- Tailwind CSS (built) -->
    <link rel="stylesheet" href="/dist/output.css">

    <!-- Supabase Configuration (must be before any scripts) -->
    <meta name="supabase-config" data-url="https://pjtuisyvpvoswmcgxsfs.supabase.co" data-anon="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBqdHVpc3l2cHZvc3dtY2d4c2ZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1Mzg1MDUsImV4cCI6MjA3NzExNDUwNX0.Zj8WxKjj8d2tq2c5ATxN5RtvuIK5sLXPzM2ZC00vIzY">
    
    <!-- Supabase CDN - Load FIRST -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

    <!-- Enhanced CSS Styles -->
    <style>
        body {
            background: linear-gradient(-45deg, #1e3a8a, #3b82f6, #8b5cf6, #ec4899);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            min-height: 100vh;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .glassmorphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .gradient-text {
            background: linear-gradient(45deg, #3b82f6, #8b5cf6, #ec4899);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 3s ease infinite;
        }
        
        .vote-card {
            transition: all 0.3s ease;
            transform-style: preserve-3d;
        }
        
        .vote-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .participant-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            animation: float 4s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .vote-button {
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .vote-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }
        
        .vote-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .vote-button:hover::before {
            left: 100%;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
            background-size: 200% 100%;
            animation: gradient 2s ease infinite;
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hidden { display: none; }
        
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #ffffff;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .vote-amount-btn {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .vote-amount-btn:hover {
            border-color: rgba(59, 130, 246, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .vote-amount-btn.active {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.3);
        }

        .payment-method-btn {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .payment-method-btn:hover:not(.disabled) {
            border-color: rgba(59, 130, 246, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .payment-method-btn.active {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.3);
        }
        
        .payment-method-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        .error-input {
            border-color: #ef4444 !important;
        }
        
        .error-message {
            color: #fca5a5;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body class="text-white">
    <!-- Navigation -->
    <nav class="glassmorphism border-b border-white/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-xl font-bold gradient-text">
                        FlyMadd Creative
                    </a>
                    <span class="text-white/60">|</span>
                    <span class="text-white font-medium">One Dream Initiative</span>
                </div>
                <div class="flex items-center space-x-6">
                    <a href="Onedream.html" class="text-white/80 hover:text-white transition-colors">Dashboard</a>
                    <a href="search.html" class="text-white/80 hover:text-white transition-colors">Find Participant</a>
                    <a href="leadershipBoard.html" class="text-white/80 hover:text-white transition-colors">Leaderboard</a>
                    <a href="registration.html" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
                        Join Initiative
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-2xl w-full">
            
            <!-- Loading State -->
            <div id="loadingState" class="text-center mb-8">
                <div class="glassmorphism rounded-2xl p-8 fade-in">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <h2 class="text-2xl font-bold mb-2">Loading Participant...</h2>
                    <p class="text-white/80">Please wait while we fetch the details</p>
                </div>
            </div>

            <!-- Error State -->
            <div id="errorState" class="hidden text-center mb-8">
                <div class="glassmorphism rounded-2xl p-8 fade-in border-red-500/30">
                    <div class="text-yellow-400 text-6xl mb-4">üëã</div>
                    <h2 class="text-2xl font-bold mb-2 text-red-300">Welcome To The One Dream Initiative</h2>
                    <p class="text-white/80 mb-6" id="errorMessage">
                        We couldn't find the participant you're looking for.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <a href="search.html" 
                           class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors">
                            üîç Find Participant
                        </a>
                        <a href="leadershipBoard.html" 
                           class="bg-white/20 hover:bg-white/30 text-white px-6 py-3 rounded-lg transition-colors">
                            üìä View Leaderboard
                        </a>
                        <a href="registration.html" 
                           class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors">
                            ‚ûï Join Initiative
                        </a>
                    </div>
                </div>
            </div>

            <!-- Participant Card -->
            <div id="participantCard" class="hidden">
                <!-- Header -->
                <div class="text-center mb-8 fade-in">
                    <h1 class="text-4xl md:text-5xl font-bold gradient-text mb-4">
                        Cast Your Vote
                    </h1>
                    <p class="text-xl text-white/80">
                        Support this participant's dream in the One Dream Initiative
                    </p>
                </div>

                <!-- Participant Details -->
                <div class="glassmorphism rounded-2xl p-8 mb-8 vote-card">
                    <div class="flex flex-col md:flex-row items-center gap-8">
                        <!-- Avatar -->
                        <div class="participant-avatar w-32 h-32 rounded-full flex items-center justify-center text-4xl font-bold text-white">
                            <span id="participantInitials">?</span>
                        </div>
                        
                        <!-- Details -->
                        <div class="flex-1 text-center md:text-left">
                            <h2 class="text-3xl font-bold mb-2" id="participantName">Loading...</h2>
                            <p class="text-xl text-blue-300 mb-2">@<span id="participantUsername">username</span></p>
                            <p class="text-white/80 mb-4" id="participantEmail">email@example.com</p>
                            
                            <!-- Stats -->
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div class="bg-white/10 rounded-lg p-3 text-center">
                                    <div class="text-2xl font-bold" id="currentVotes">0</div>
                                    <div class="text-sm text-white/70">Current Votes</div>
                                </div>
                                <div class="bg-white/10 rounded-lg p-3 text-center">
                                    <div class="text-2xl font-bold" id="participantRank">#1</div>
                                    <div class="text-sm text-white/70">Leaderboard Rank</div>
                                </div>
                            </div>
                            
                            <!-- Progress Bar -->
                            <div class="mb-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span>Progress to Goal</span>
                                    <span id="progressPercentage">0%</span>
                                </div>
                                <div class="w-full bg-white/20 rounded-full h-3">
                                    <div class="progress-bar h-3 rounded-full transition-all duration-1000" 
                                         id="progressBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Voting Section -->
                <div class="glassmorphism rounded-2xl p-8 mb-8">
                    <div class="text-center">
                        <h3 class="text-2xl font-bold mb-4">Support This Dream</h3>
                        <p class="text-white/80 mb-6">
                            Each vote costs $2 and brings this participant closer to their goal of 1 million votes.
                        </p>
                        
                        <!-- Vote Amount Selection -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            <button class="vote-amount-btn bg-white/20 hover:bg-white/30 p-4 rounded-lg transition-all border-2 border-transparent"
                                    data-amount="1" data-cost="2">
                                <div class="text-xl font-bold">1 Vote</div>
                                <div class="text-sm text-white/70">$2.00</div>
                            </button>
                            <button class="vote-amount-btn bg-white/20 hover:bg-white/30 p-4 rounded-lg transition-all border-2 border-transparent"
                                    data-amount="5" data-cost="10">
                                <div class="text-xl font-bold">5 Votes</div>
                                <div class="text-sm text-white/70">$10.00</div>
                            </button>
                            <button class="vote-amount-btn bg-white/20 hover:bg-white/30 p-4 rounded-lg transition-all border-2 border-transparent"
                                    data-amount="10" data-cost="20">
                                <div class="text-xl font-bold">10 Votes</div>
                                <div class="text-sm text-white/70">$20.00</div>
                            </button>
                            <button class="vote-amount-btn bg-white/20 hover:bg-white/30 p-4 rounded-lg transition-all border-2 border-transparent"
                                    data-amount="25" data-cost="50">
                                <div class="text-xl font-bold">25 Votes</div>
                                <div class="text-sm text-white/70">$50.00</div>
                            </button>
                        </div>
                        
                        <!-- Custom Amount -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">Custom Vote Amount</label>
                            <input type="number" id="customVoteAmount" min="1" max="1000" 
                                   class="w-full bg-white/10 border border-white/30 rounded-lg px-4 py-3 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Enter number of votes">
                            <p class="text-sm text-white/60 mt-2">
                                Total cost: $<span id="totalCost">2.00</span>
                            </p>
                        </div>

                        <!-- Payment Method Selection -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-4 text-center">Choose Payment Method</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <button class="payment-method-btn bg-white/20 hover:bg-white/30 p-4 rounded-lg transition-all border-2 border-transparent"
                                        data-method="paystack" id="paystackBtn">
                                    <div class="text-3xl mb-2">üè¶</div>
                                    <div class="font-bold">Bank Transfer</div>
                                    <div class="text-sm text-white/70">PayStack</div>
                                </button>
                                <button class="payment-method-btn bg-white/20 hover:bg-white/30 p-4 rounded-lg transition-all border-2 border-transparent active"
                                        data-method="crypto" id="cryptoBtn">
                                    <div class="text-3xl mb-2">‚Çø</div>
                                    <div class="font-bold">Cryptocurrency</div>
                                    <div class="text-sm text-white/70">BTC/ETH/USDT</div>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Vote Button -->
                        <button id="voteButton" class="vote-button w-full py-4 px-8 rounded-xl text-white font-bold text-lg transition-all duration-300 disabled:opacity-50">
                            <span id="voteButtonText">Purchase Votes - $2.00</span>
                            <div id="voteButtonSpinner" class="loading-spinner hidden inline-block ml-2"></div>
                        </button>
                        
                        <!-- Payment Methods -->
                        <div class="mt-6 text-center">
                            <p class="text-sm text-white/60 mb-3">Secure payment powered by</p>
                            <div class="flex justify-center items-center space-x-6">
                                <span class="text-lg font-bold text-green-400">PayStack</span>
                                <span class="text-white/40">‚Ä¢</span>
                                <span class="text-lg font-bold text-orange-400">Crypto</span>
                            </div>
                            <p class="text-xs text-white/50 mt-2">
                                Choose your preferred payment method above
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Share Section -->
                <div class="glassmorphism rounded-2xl p-8">
                    <div class="text-center">
                        <h3 class="text-xl font-bold mb-4">Share & Support</h3>
                        <p class="text-white/80 mb-6">
                            Help spread the word about this participant's journey
                        </p>
                        
                        <div class="flex justify-center space-x-4">
                            <button onclick="shareOnTwitter()" 
                                    class="bg-blue-500 hover:bg-blue-600 p-3 rounded-lg transition-colors">
                                üê¶ Twitter
                            </button>
                            <button onclick="shareOnFacebook()" 
                                    class="bg-blue-700 hover:bg-blue-800 p-3 rounded-lg transition-colors">
                                üìò Facebook
                            </button>
                            <button onclick="copyVoteLink()" 
                                    class="bg-gray-600 hover:bg-gray-700 p-3 rounded-lg transition-colors">
                                üîó Copy Link
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="glassmorphism rounded-2xl p-8 max-w-md w-full text-center">
            <div class="text-6xl mb-4">üéâ</div>
            <h3 class="text-2xl font-bold mb-4">Payment Successful!</h3>
            <p class="text-white/80 mb-6">
                Thank you for supporting <span id="successParticipantName">this participant</span>!
                Your payment for <span id="successVoteCount">1</span> vote(s) has been processed successfully.
            </p>
            <div class="flex flex-col sm:flex-row gap-4">
                <button onclick="closeSuccessModal()" 
                        class="bg-white/20 hover:bg-white/30 px-6 py-3 rounded-lg transition-colors">
                    Purchase More Votes
                </button>
                <a href="leadershipBoard.html" 
                   class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg transition-colors">
                    View Leaderboard
                </a>
            </div>
        </div>
    </div>
    
    <!-- ========================================
         ‚úÖ FIXED SCRIPTS - CORRECT ORDER & URLS
         ======================================== -->
    
    <!-- 1. Core Libraries - MUST load first -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    
    <!-- 2. WalletConnect bundle (built) -->
    <script src="/js/wc-bundle.js"></script>

    <!-- 3. Initialize Global State & WalletConnect Loader -->
    <script>
        console.log('üöÄ Vote Page Loading...');
        
        // Global state
        window.currentParticipant = null;
        window.selectedVoteAmount = 1;
        window.selectedCost = 2.00;
        window.selectedPaymentMethod = 'crypto';
        
        // WalletConnect Project ID (get from https://cloud.walletconnect.com)
        window.WALLETCONNECT_PROJECT_ID = '61d9b98f81731dffa9988c0422676fc5';
        
        // Load WalletConnect dynamically when needed (lazy loading) with ESM + UMD fallback
        window.loadWalletConnect = async function() {
            if (window.EthereumProvider) {
                console.log('‚úÖ WalletConnect already loaded');
                return true;
            }

            const esmUrl = 'https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2.11.0/+esm';
            const umdUrl = 'https://unpkg.com/@walletconnect/ethereum-provider@2.11.0/dist/umd/index.min.js';

            // Try ESM dynamic import first
            try {
                console.log('üì¶ Loading WalletConnect (ESM)...');
                const module = await import(esmUrl);
                window.EthereumProvider = module && (module.EthereumProvider || module.default?.EthereumProvider || module.default);
                if (window.EthereumProvider) {
                    console.log('‚úÖ WalletConnect (ESM) loaded successfully');
                    return true;
                }
                console.warn('ESM loaded but provider not found, falling back to UMD');
            } catch (err) {
                console.warn('ESM import failed:', err);
            }

            // Fallback: inject UMD script tag
            return new Promise((resolve, reject) => {
                try {
                    console.log('üì¶ Loading WalletConnect (UMD fallback)...');
                    const s = document.createElement('script');
                    s.src = umdUrl;
                    s.async = true;
                    s.onload = () => {
                        // Try common global names the UMD bundle might expose
                        window.EthereumProvider = window.EthereumProvider || window.WalletConnectProvider || window.walletConnectProvider || window.ethereumProvider || window.EthereumProvider || window.default?.EthereumProvider;
                        if (window.EthereumProvider) {
                            console.log('‚úÖ WalletConnect (UMD) loaded');
                            resolve(true);
                        } else {
                            reject(new Error('UMD loaded but provider not found'));
                        }
                    };
                    s.onerror = (e) => reject(new Error('Failed to load WalletConnect UMD script'));
                    document.head.appendChild(s);
                } catch (err) {
                    reject(err);
                }
            });
        };
    </script>
    
    <!-- 4. Supabase Config -->
    <script src="/js/supabase-config.js"></script>

    <!-- 5. Crypto Payments Module -->
    <script src="/js/crypto-payments.js"></script>

    <!-- 6. Main Vote Logic -->
    <script src="/js/vote.js"></script>
    
    <!-- 6. Page Ready -->
    <script>
        console.log('‚úÖ All core scripts loaded');
        console.log('üí° WalletConnect will load on-demand when crypto payment is selected');
    </script>
</body>
</html>